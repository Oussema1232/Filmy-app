(this.webpackJsonpfilmy=this.webpackJsonpfilmy||[]).push([[0],{12:function(e){e.exports=JSON.parse('{"apiUrl":"http://localhost:3001/api"}')},41:function(e,t,a){e.exports=a(75)},46:function(e,t,a){},75:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(18),c=a.n(o),s=(a(46),a(47),a(48),a(2)),l=a(6),i=a(3),u=a(4),m=a(19),p=a(15),d=a(5),v=a.n(d),f=a(11),h=a(17),g=a.n(h);var b={init:function(){},log:function(e){console.log(e.message)}};g.a.interceptors.response.use(null,(function(e){return e.response&&e.response.status>=400&&e.response.status<500||(m.b.error("an unexpected error accured"),b.log(e)),Promise.reject(e)}));var E={get:g.a.get,put:g.a.put,delete:g.a.delete,post:g.a.post,setJwt:function(e){g.a.defaults.headers.common["x-auth-token"]=e}},k=a(12),y=a(38),j=a.n(y);function O(){return(O=Object(f.a)(v.a.mark((function e(t,a){var n,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.post("".concat(k.apiUrl,"/auth"),{email:t,password:a});case 2:n=e.sent,r=n.data,localStorage.setItem("token",r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}E.setJwt(localStorage.getItem("token"));var w={login:function(e,t){return O.apply(this,arguments)},loginWithjwt:function(e){localStorage.setItem("token",e)},logout:function(){localStorage.removeItem("token")},getCurrentUser:function(){try{var e=localStorage.getItem("token");return j()(e)}catch(t){return null}}},S=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"componentDidMount",value:function(){w.logout(),window.location="/"}},{key:"render",value:function(){return null}}]),a}(n.Component),C=a(9),N=a(26),x=a(7);function I(e){return E.delete("".concat(k.apiUrl,"/movies/").concat(e))}function P(e){return E.get("".concat(k.apiUrl,"/movies/").concat(e))}function G(e){if(e._id){var t=Object(C.a)({},e);return delete t._id,E.put("".concat(k.apiUrl,"/movies/").concat(e._id),t)}return E.post("".concat(k.apiUrl,"/movies"),e)}function R(){return E.get("".concat(k.apiUrl,"/genres"))}var U=a(16),_=a.n(U),A=function(e){var t=e.maxPage,a=e.movieNumber,n=e.handlepageChange,o=e.currentPage,c=_.a.ceil(a/t)+1;if(c<=2)return null;var s=_.a.range(1,c);return r.a.createElement("nav",null,r.a.createElement("ul",{className:"pagination"},s.map((function(e){return r.a.createElement("li",{className:o===e?"page-item active":"page-item",key:e,onClick:function(){return n(e)}},r.a.createElement("button",{className:"page-link"},e))}))))},q=function(e,t,a){return e.slice((t-1)*a,(t-1)*a+4)},M=function(e,t){return"All Genres"===e.genre?t:t.filter((function(t){return t.genre.genre===e.genre}))},D=function(e){var t=e.genres,a=e.selectedGenre,n=e.onGenreSelect,o=e.textProprety,c=void 0===o?"genre":o,s=e.valueProprety,l=void 0===s?"_id":s;return r.a.createElement("ul",{className:"list-group-sm "},t.map((function(e){return r.a.createElement("li",{key:e[l],className:a===e?"list-group-item list-group-item-dark active":"list-group-item list-group-item-dark",onClick:function(){return n(e)}},e[c])})))},B=function(e){var t=e.liked;return r.a.createElement("i",{style:{cursor:"pointer"},className:t?"fa fa-heart":"fa fa-heart-o",onClick:e.likemovie})},L=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(e=t.call.apply(t,[this].concat(o))).raiseSort=function(t){var a=Object(C.a)({},e.props.sortColumn);a.path===t?a.order="asc"===a.order?"desc":"asc":(a.path=t,a.order="asc"),e.props.onSort(a),e.sortIcon(e.props.sortColumn,t)},e.sortIcon=function(t){var a=e.props.sortColumn;return t.path!==a.path?null:"asc"===a.order?r.a.createElement("i",{className:"fa fa-sort-asc"}):r.a.createElement("i",{className:"fa fa-sort-desc"})},e}return Object(l.a)(a,[{key:"render",value:function(){var e=this,t=this.props.columns;return r.a.createElement("thead",null,r.a.createElement("tr",null,t.map((function(t){return r.a.createElement("th",{className:"clickable",key:t.label||t.key,onClick:function(){return e.raiseSort(t.path)}},t.label,e.sortIcon(t))}))))}}]),a}(n.Component),J=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).getElement=function(e,t){return t.content?t.content(e):_.a.get(e,t.path)},e.createKey=function(e,t){return e._id+(t.key||t.path)},e}return Object(l.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.data,n=t.columns;return r.a.createElement("tbody",null,a.map((function(t){return r.a.createElement("tr",{key:t._id},n.map((function(a){return r.a.createElement("td",{key:e.createKey(t,a)},e.getElement(t,a))})))})))}}]),a}(n.Component),T=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this.props,t=e.columns,a=e.onSort,n=e.sortColumn,o=e.data;return r.a.createElement("table",{className:"table table-primary "},r.a.createElement(L,{columns:t,onSort:a,sortColumn:n}),r.a.createElement(J,{data:o,columns:t}))}}]),a}(n.Component),W=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(e=t.call.apply(t,[this].concat(o))).columns=[{content:function(e){return r.a.createElement(x.c,{to:localStorage.getItem("token")?"/movies/".concat(e._id):"/login"},e.title)},label:"Title"},{path:"genre.genre",label:"Genre"},{path:"numberInStock",label:"Stock"},{path:"dailyRentalRate",label:"Rate"},{key:"like",content:function(t){return r.a.createElement(B,{liked:t.like,likemovie:function(){return e.props.onLike(t)}})}},{key:"delete",content:w.getCurrentUser()&&w.getCurrentUser().isAdmin?function(t){return r.a.createElement("button",{className:"btn btn-danger",onClick:function(){return e.props.onDelete(t._id)}},"Delete")}:null}],e}return Object(l.a)(a,[{key:"render",value:function(){var e=this.props,t=e.movies,a=e.onSort,n=e.sortColumn;return r.a.createElement(T,{data:t,columns:this.columns,onSort:a,sortColumn:n})}}]),a}(n.Component),F=function(e){var t=e.name,a=e.label,n=e.onChange,o=e.value;return r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{forhtml:t},a),r.a.createElement("input",{name:t,className:"form-control",id:t,value:o,onChange:n}))},z=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={movies:[],genres:[],loading:!0,maxPage:4,currentPage:1,sortColumn:{path:"title",order:"asc"},selectedGenre:{genre:"All Genres",_id:123123123},data:{query:""}},e.deletthemovie=function(){var t=Object(f.a)(v.a.mark((function t(a){var n,r;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.state.movies,r=n.filter((function(e){return e._id!==a})),e.setState({movies:r}),t.prev=3,t.next=6,I(a);case 6:t.next=12;break;case 8:t.prev=8,t.t0=t.catch(3),t.t0.response&&404===t.t0.response.status&&Object(m.b)("movie already deleted"),e.setState({movies:n});case 12:case"end":return t.stop()}}),t,null,[[3,8]])})));return function(e){return t.apply(this,arguments)}}(),e.likemovie=function(t){var a=Object(N.a)(e.state.movies),n=e.state.movies.indexOf(t);a[n].like=!a[n].like,e.setState({movies:a})},e.handlepageChange=function(t){e.setState({currentPage:t})},e.onGenreSelect=function(t){e.setState({selectedGenre:t,currentPage:1})},e.handleSorting=function(t){e.setState({sortColumn:t})},e.onchange=function(t){var a=t.currentTarget,n=Object(C.a)({},e.state.data),r=a.value;n[a.name]=r,e.setState({data:n})},e.getPagedData=function(){var t,a=e.state,n=a.maxPage,r=a.currentPage,o=a.movies,c=a.selectedGenre,s=a.sortColumn,l=e.state.data.query;if(l){var i=o,u=l.toLowerCase();t=i.filter((function(e){return e.title.toLowerCase().startsWith(u)}))}else t=M(c,o);var m=t.length,p=_.a.orderBy(t,[s.path],[s.order]);return{count:m,movies:q(p,r,n)}},e}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=Object(f.a)(v.a.mark((function e(){var t,a,n,r,o;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R();case 2:return t=e.sent,a=t.data,n=[{genre:"All Genres",_id:123123123}].concat(Object(N.a)(a)),e.next=7,E.get("".concat(k.apiUrl,"/movies"));case 7:r=e.sent,o=r.data,this.setState({movies:o,genres:n,loading:!1});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.maxPage,a=e.currentPage,n=e.selectedGenre,o=e.sortColumn,c=e.genres,s=e.loading,l=e.data,i=this.props.user,u=this.getPagedData(),m=u.count,p=u.movies;return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-3"},r.a.createElement(D,{selectedGenre:n,onGenreSelect:this.onGenreSelect,genres:c})),r.a.createElement("div",{className:"col"},s?r.a.createElement("div",{className:"spinner-border text-primary",role:"status"},r.a.createElement("span",{className:"sr-only"},"Loading...")):r.a.createElement("div",null,i&&r.a.createElement(x.b,{to:localStorage.getItem("token")?"/movies/new":"/login"},r.a.createElement("button",{className:"btn btn-info"},"Create Movie")),r.a.createElement(F,{name:"query",label:"SearchBox",onChange:this.onchange,value:l.query}),m>0?r.a.createElement("div",null,"All Genres"!==n.genre?r.a.createElement("h3",{style:{color:"#eee"}},"Number of ",n.genre," movies is ",m):r.a.createElement("h3",{style:{color:"#eee"}},"Number of total movies is ",m),r.a.createElement(W,{movies:p,onLike:this.likemovie,onDelete:this.deletthemovie,sortColumn:o,onSort:this.handleSorting}),r.a.createElement(A,{maxPage:t,movieNumber:m,handlepageChange:this.handlepageChange,currentPage:a})):r.a.createElement("h3",{style:{color:"#eee"}},"there are no movies "))))}}]),a}(n.Component);var K=function(e){var t=e.user;return r.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-dark bg-dark"},r.a.createElement(x.b,{className:"navbar-brand",to:"/"},"Filmy"),r.a.createElement(x.c,{className:"nav-item nav-link",to:"/movies"},"Movies"),r.a.createElement(x.c,{className:"nav-item nav-link",to:"/customers"},"Customers"),r.a.createElement(x.c,{className:"nav-item nav-link",to:"/rentals"},"Rentals"),t?r.a.createElement(r.a.Fragment,null,r.a.createElement(x.c,{className:"nav-item nav-link",to:"/"},t.name),r.a.createElement(x.c,{className:"nav-item nav-link",to:"/logout"},"logout")):r.a.createElement(r.a.Fragment,null,r.a.createElement(x.c,{className:"nav-item nav-link",to:"/login"},"Login"),r.a.createElement(x.c,{className:"nav-item nav-link",to:"/register"},"Register")))},V=function(){return r.a.createElement("h1",null,"Rentals")},$=function(){return r.a.createElement("h1",null,"Customers")},H=a(8),Q=a.n(H),X=a(20),Y=a(22),Z=function(e){var t=e.name,a=e.label,n=e.error,o=Object(Y.a)(e,["name","label","error"]);return r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{forhtml:t},a),r.a.createElement("input",Object.assign({name:t,className:"form-control",id:t},o)),n&&r.a.createElement("div",{className:"alert alert-danger",role:"alert"},n))},ee=function(e){var t=e.options,a=e.name,n=e.label,o=e.errors,c=e.value,s=e.onChange;return r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{forhtml:a},n),r.a.createElement("select",{className:"form-control",id:a,onChange:s,value:c,name:a},r.a.createElement("option",{value:""}),t.map((function(e){return r.a.createElement("option",{key:e._id,value:e._id},e.genre)}))),o&&r.a.createElement("div",{className:"aler alert-danger"},o))},te=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(e=t.call.apply(t,[this].concat(o))).state={data:{},errors:{},genres:[]},e.onchange=function(t){var a=t.currentTarget,n=Object(C.a)({},e.state.data);n[a.name]=a.value;var r=e.validateProprety(a.name,a.value);e.setState({data:n,errors:r||{}})},e.validation=function(){var t=e.state.data,a=Q.a.validate(t,e.schema,{abortEarly:!1}).error;if(!a)return null;var n={};return a.details.map((function(e){return n[e.path[0]]=e.message})),n},e.validateProprety=function(t,a){var n=Object(X.a)({},t,e.schema[t]),r=Object(X.a)({},t,a),o=Q.a.validate(r,n).error;if(!o)return null;var c={};return c[t]=o.details[0].message,c},e.onSubmit=function(t){t.preventDefault();var a=e.validation();a&&e.setState({errors:a}||{}),e.dosubmit()},e.renderInput=function(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text",o=e.state,c=o.data,s=o.errors;return r.a.createElement(Z,{name:t,type:n,label:a,error:s[t],value:c[t],onChange:e.onchange})},e.renderButton=function(t){return r.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:e.onSubmit,disabled:e.validation()},t)},e.renderSelect=function(t,a){var n=e.state,o=n.genres,c=n.errors,s=n.data;return r.a.createElement(ee,{options:o,name:t,label:a,errors:c[t],value:s[t],onChange:e.onchange})},e}return a}(n.Component),ae=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={data:{username:"",password:""},errors:{}},e.schema={username:Q.a.string().required().min(3),password:Q.a.string().required().min(5)},e.dosubmit=Object(f.a)(v.a.mark((function t(){var a,n,r,o,c;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=e.state.data,n=a.username,r=a.password,t.next=4,w.login(n,r);case 4:o=e.props.location.state,window.location=o?o.from.pathname:"/",t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),t.t0.response&&400===t.t0.response.status&&((c=Object(C.a)({},e.state.errors)).username=t.t0.response.data,e.setState({errors:c}));case 11:case"end":return t.stop()}}),t,null,[[0,8]])}))),e}return Object(l.a)(a,[{key:"render",value:function(){return r.a.createElement("form",null,this.renderInput("username","Username"),this.renderInput("password","Password","password"),this.renderButton("Login"))}}]),a}(te);function ne(e,t,a){return E.post("".concat(k.apiUrl,"/users"),{email:e,name:t,password:a})}var re=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={data:{username:"",password:"",name:""},errors:{}},e.schema={username:Q.a.string().email().required().min(3),password:Q.a.string().required().min(5),name:Q.a.string().required().min(4)},e.dosubmit=Object(f.a)(v.a.mark((function t(){var a,n,r,o,c,s;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=e.state.data,n=a.username,r=a.password,o=a.name,t.next=4,ne(n,o,r);case 4:c=t.sent,w.loginWithjwt(c.headers["x-auth-token"]),window.location="/",t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),t.t0.response&&400===t.t0.response.status&&((s=Object(C.a)({},e.state.errors)).username=t.t0.response.data,e.setState({errors:s}));case 12:case"end":return t.stop()}}),t,null,[[0,9]])}))),e}return Object(l.a)(a,[{key:"render",value:function(){return r.a.createElement("form",null,this.renderInput("username","Username"),this.renderInput("password","Password","password"),this.renderInput("name","Name"),this.renderButton("Register"))}}]),a}(te),oe=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={data:{title:"",genreId:"",dailyRentalRate:"",numberInStock:""},errors:{},genres:[]},e.populateGenres=Object(f.a)(v.a.mark((function t(){var a,n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,R();case 2:a=t.sent,n=a.data,e.setState({genres:n});case 5:case"end":return t.stop()}}),t)}))),e.populateMovies=Object(f.a)(v.a.mark((function t(){var a,n,r,o;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"new"!==(a=e.props.match.params.id)){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,P(a);case 6:n=t.sent,r=n.data,o=e.maptoViewModel(r),e.setState({data:o}),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),t.t0.response&&404===t.t0.response.status&&e.props.history.replace("/not-found");case 15:case"end":return t.stop()}}),t,null,[[0,12]])}))),e.maptoViewModel=function(e){return{title:e.title,dailyRentalRate:e.dailyRentalRate,_id:e._id,numberInStock:e.numberInStock,genreId:e.genre._id}},e.capitalize=function(){var t=Object(C.a)({},e.state.data),a=t.title;return a=a[0].toUpperCase()+a.slice(1),t.title=a,t},e.schema={_id:Q.a.string(),title:Q.a.string().required().label("Title"),genreId:Q.a.string().required().label("Genre"),dailyRentalRate:Q.a.number().required().min(0).max(10).label("Rate"),numberInStock:Q.a.number().required().min(0).max(100).label("Stock")},e.dosubmit=Object(f.a)(v.a.mark((function t(){var a;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.capitalize(),t.next=3,G(a);case 3:e.props.history.push("/movies");case 4:case"end":return t.stop()}}),t)}))),e}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.populateGenres(),this.populateMovies()}},{key:"render",value:function(){return r.a.createElement("form",null,this.renderInput("title","Title"),this.renderSelect("genreId","Genres"),this.renderInput("numberInStock","Stock"),this.renderInput("dailyRentalRate","Rate"),this.renderButton("Save"))}}]),a}(te),ce=function(){return r.a.createElement("h1",null,"NotFound")},se=function(e){var t=e.component,a=e.render,n=Object(Y.a)(e,["component","render"]);return r.a.createElement(p.b,Object.assign({},n,{render:function(e){return console.log("oki"),w.getCurrentUser()?t?r.a.createElement(t,e):a(e):r.a.createElement(p.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},le=(a(74),function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={},e}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=w.getCurrentUser();this.setState({user:e})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"container-fluid bg-dark",style:{height:"100vh",padding:10,color:"#eee"}},r.a.createElement(m.a,null),r.a.createElement(K,{user:this.state.user}),r.a.createElement(p.d,null,r.a.createElement(se,{path:"/movies/:id",component:oe}),r.a.createElement(p.b,{path:"/rentals",component:V}),r.a.createElement(p.b,{path:"/movies",render:function(t){return r.a.createElement(z,Object.assign({},t,{user:e.state.user}))}}),r.a.createElement(p.b,{path:"/customers",component:$}),r.a.createElement(p.b,{path:"/login",component:ae}),r.a.createElement(p.b,{path:"/register",component:re}),r.a.createElement(p.b,{path:"/logout",component:S}),r.a.createElement(p.b,{path:"/not-found",component:ce}),r.a.createElement(p.a,{from:"/",exact:!0,to:"/movies"}),r.a.createElement(p.a,{to:"/not-found"})))}}]),a}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(x.a,null,r.a.createElement(le,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[41,1,2]]]);
//# sourceMappingURL=main.2b496037.chunk.js.map